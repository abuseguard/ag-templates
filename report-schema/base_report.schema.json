{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://raw.githubusercontent.com/abuseguard/ag-templates/main/report-schema/base_report.schema.json",
    "$defs": {
        "ReporterInfo": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
                "ReporterType": {
                    "$comment": "Contact info is optional if the reporter is a natural person",
                    "enum": ["Org", "Person"],
                    "default": "Person"
                },
                "ReporterName": {
                    "type": "string"
                },
                "ReporterEmail": {
                    "type": "string"
                },
                "ReporterPhone": {
                    "type": "string"
                },
                "ReporterTitle": {
                    "type": "string"
                },
                "ReporterOrg": {
                    "type": "string"
                },
                "Disclose": {
                    "type": "boolean",
                    "description": "If true, the reporter allows the recipient to disclose the reporter's identity to the reported party",
                    "default": false
                }
            },
            "if": {
                "not": { "properties": { "ReporterType": { "const": "Person" } } }
            },
            "then": {
                "required": ["ReporterOrg"]
            },
            "required": ["ReporterName","ReporterEmail","ReporterType"]
        }
    },
    "properties": {
        "Base": {
            "type":"object",
            "allOf": [
                {
                    "type":"object",
                    "properties": {
                        "ReporterInfo": {
                            "$ref":"#/$defs/ReporterInfo"
                        },
                        "OnBehalfOf": {
                            "$ref":"#/$defs/ReporterInfo"
                        }
                    }
                }
            ]
        },
        "InternalSchema": {
            "type":"object",
            "properties": {
                "UserInformation": {
                    "properties": {
                        "Id": {
                            "type": "string",
                            "description": "Internal ID of the reportee."
                        },
                        "UserData": {
                            "type": "object",
                            "description": "Data about a customer normally returned by a resolver in the process of determining the reportee.",
                            "additionalProperties": {
                              "type": "string"
                            }
                        }
                    }
                },
                "AccountInformation": {
                    "properties": {
                        "Id": {
                            "type": "string",
                            "description": "Internal ID of the account."
                        },
                        "AccountData": {
                            "type": "object",
                            "description": "Data about a customer account normally returned by a resolver in the process of determining the reportee.",
                            "additionalProperties": {
                              "type": "string"
                            }
                        }
                    }
                },
                "Priority": {
                    "type": "string",
                    "description": "Priority of the report",
                    "enum": ["low", "medium", "high"]
                },
                "ReportedAt": {
                    "type": "string",
                    "format": "date-time",
                    "description": "Timestamp of the report"
                },
                "EventTags": {
                    "type": "array",
                    "description": "Custom tags for classification, metrics and other internal uses.",
                    "items": {
                      "type": "string"
                    }
                }

            }
        },
        "EventBase": {
            "type":"object",
            "allOf": [
                {
                    "type":"object",
                    "properties": {
                        "ReportClass": {
                          "type": "string",
                          "description": "class of the reported abuse event",
                          "enum": ["Content", "Activity", "Vulnerability"]
                        },
                        "ReportType": {
                          "type": "string",
                          "description": "type of the reported abuse event",
                          "minLength": 1
                        },
                        "ReporterSeverity": {
                          "type": "string",
                          "description": "class of the reported abuse event",
                          "enum": ["low", "medium", "high"]
                        },
                        "ReporterNotes": {
                            "type": "string",
                            "description": "free text - notes by the reporter"
                        }
                      },
                      "required": ["ReportClass", "ReportType"] 
                }
            ]
        
        }
    }
}
